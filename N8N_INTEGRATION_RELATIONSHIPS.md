# n8n 功能關聯性與快速連結指南

## 📊 功能關聯性圖表

### 🌐 網站架設核心流程

#### 1️⃣ 網站表單處理流程

```
┌─────────────────┐
│  網站表單提交   │
│  (Webhook)      │
└────────┬────────┘
         │
         ├─→ 📧 Email 通知 ──→ ✉️ 發送給管理員
         ├─→ 💬 LINE 推播 ──→ 📱 通知管理員
         ├─→ 💾 資料庫儲存 ──→ 📊 Supabase 儲存
         ├─→ 💬 Slack 通知 ──→ 👥 通知團隊
         ├─→ 📋 CRM 同步 ──→ 🏢 客戶資料管理
         └─→ 🔄 自動回覆 ──→ ✅ 確認訊息發送
```

**快速連結：**
- 📧 Email 通知設定 → 步驟 12
- 💬 LINE 推播設定 → 步驟 36 (LINE 推播)
- 💾 資料庫儲存 → 步驟 23 (資料庫備份)
- 💬 Slack 通知 → 步驟 36 (Slack 整合)

---

#### 2️⃣ 使用者註冊流程

```
┌─────────────────┐
│   使用者註冊    │
│  (Supabase Auth)│
└────────┬────────┘
         │
         ├─→ ✉️ 歡迎 Email ──→ 📧 註冊確認信
         ├─→ 💬 LINE 通知 ──→ 📱 歡迎訊息
         ├─→ 💾 使用者資料 ──→ 📊 建立使用者資料表
         ├─→ 🎁 優惠券發送 ──→ 🎫 LINE 優惠券
         ├─→ 📋 CRM 建立 ──→ 🏢 新增客戶資料
         └─→ 🔄 定期回訪 ──→ ⏰ 7天後 LINE 提醒使用
```

**快速連結：**
- ✉️ Email 自動化 → 步驟 47 (Email 行銷)
- 💬 LINE 訊息 → 步驟 13 (LINE Webhook)
- 💾 資料庫 → 步驟 25 (資料庫遷移)
- 🔄 定期回訪 → 步驟 36 (LINE 推播) + 排程功能

---

#### 3️⃣ 訂單處理流程

```
┌─────────────────┐
│   訂單建立      │
│  (Webhook)      │
└────────┬────────┘
         │
         ├─→ 📧 訂單確認 Email ──→ ✉️ 發送確認信
         ├─→ 💬 LINE 訂單通知 ──→ 📱 即時通知
         ├─→ 📦 庫存更新 ──→ 💾 更新庫存資料
         ├─→ 💰 付款處理 ──→ 💳 Stripe/PayPal
         ├─→ 📋 CRM 更新 ──→ 🏢 更新訂單狀態
         ├─→ 📦 出貨通知 ──→ 📱 LINE 推播物流資訊
         └─→ 🔄 付款提醒 ──→ ⏰ 未付款 24 小時後 LINE 提醒
```

**快速連結：**
- 💳 支付整合 → 步驟 38 (Stripe 支付)
- 💬 LINE 通知 → 步驟 36 (LINE 推播)
- 📧 Email → 步驟 12 (Email 自動化)
- 🔄 付款提醒（回訪機制）→ 步驟 36 (LINE 推播) + Cron 排程

---

### 📱 LINE 官方 API 核心流程

#### 4️⃣ LINE 訊息處理流程

```
┌─────────────────┐
│  LINE 接收訊息  │
│  (Webhook)      │
└────────┬────────┘
         │
         ├─→ 🤖 自動回覆 ──→ 💬 關鍵字回覆
         ├─→ 💾 訊息儲存 ──→ 📊 儲存對話記錄
         ├─→ 🔍 語意分析 ──→ 🧠 AI 分析（GPT）
         ├─→ 👤 客服轉接 ──→ 💬 Slack/Teams
         ├─→ 📋 表單處理 ──→ 📝 收集使用者資料
         └─→ 🔄 定期回訪 ──→ ⏰ 24 小時後 LINE 跟進
```

**快速連結：**
- 🤖 自動回覆 → 步驟 13 (LINE Webhook)
- 💾 資料儲存 → 步驟 25 (資料庫遷移)
- 🔍 AI 分析 → 步驟 42 (Mock 服務 - 可擴展 AI)
- 🔄 回訪機制 → 步驟 36 (LINE 推播) + Cron 節點

---

#### 5️⃣ LINE 推播通知流程（回訪機制）

```
┌─────────────────┐
│   觸發條件      │
│  (Cron/Webhook) │
└────────┬────────┘
         │
         ├─→ 📦 訂單狀態更新 ──→ 📱 LINE 推播狀態
         ├─→ 💰 付款提醒 ──→ ⏰ 定期提醒
         ├─→ 🎁 優惠活動 ──→ 📢 行銷推播
         ├─→ 📊 定期報表 ──→ 📈 統計資料推播
         ├─→ 🔔 系統通知 ──→ ⚠️ 重要公告
         └─→ 🔄 使用者回訪 ──→ 👋 促進再訪
```

**執行節點位置：**
- ⏰ **Cron 節點**（排程）→ 🔍 **Function 節點**（檢查條件）→ 📱 **LINE 節點**（推播）

**快速連結：**
- 📱 LINE 推播設定 → 步驟 36 (LINE 推播)
- ⏰ 排程設定 → 步驟 30 (部署驗證) - Cron 整合
- 📊 資料分析 → 步驟 48 (行為追蹤)

---

### 🔄 回訪機制標註

#### 📱 LINE API 回訪機制功能清單

以下功能具備回訪機制，可透過 LINE API 實現：

| 功能 | 回訪方式 | 執行節點 | 串接節點 | 相關步驟 |
|------|----------|----------|----------|----------|
| 🔄 訂單狀態提醒 | 訂單建立後 24 小時提醒 | Cron → Function → LINE | LINE 推播 | 步驟 36 |
| 💰 付款提醒 | 未付款 12/24/48 小時提醒 | Cron → LINE | LINE 推播 | 步驟 36 |
| 🎁 優惠券到期提醒 | 優惠券到期前 3 天提醒 | Cron → LINE | LINE 優惠券 | 步驟 13 |
| 📊 定期報表推播 | 每週/每月統計資料 | Cron → Analytics → LINE | LINE 推播 | 步驟 36, 49 |
| 👋 使用者回訪促銷 | 7 天未使用提醒 | Cron → Database → LINE | LINE 推播 | 步驟 36, 48 |
| 📦 出貨通知追蹤 | 出貨後追蹤物流 | Webhook → LINE | LINE 推播 | 步驟 36 |
| 🎂 生日祝福 | 會員生日當天祝福 | Cron → Database → LINE | LINE 推播 | 步驟 36 |
| ⚠️ 系統維護通知 | 定期系統狀態通知 | Cron → Health Check → LINE | LINE 推播 | 步驟 36, 30 |

---

## 🎯 快速串接指南

### 常用串接組合

#### 組合 1：表單 → 通知 → 儲存
```
Webhook (接收表單)
  ↓
Function (處理資料)
  ↓
┌─────────┬─────────┐
│  Email  │  LINE   │  Supabase
│  通知   │  推播   │  儲存
└─────────┴─────────┘
```
**適用場景**：聯絡表單、報名表單、意見回饋

#### 組合 2：訂單 → 付款 → 通知
```
Webhook (訂單建立)
  ↓
Stripe (付款處理)
  ↓
┌─────────┬─────────┬─────────┐
│  Email  │  LINE   │  CRM    │
│  確認   │  通知   │  同步   │
└─────────┴─────────┴─────────┘
```
**適用場景**：電子商務訂單、服務預訂

#### 組合 3：LINE 訊息 → 回覆 → 儲存
```
Webhook (LINE 訊息)
  ↓
Function (分析訊息)
  ↓
┌─────────┬─────────┬─────────┐
│  LINE   │  Database│  CRM    │
│  回覆   │  儲存    │  更新   │
└─────────┴─────────┴─────────┘
```
**適用場景**：LINE 客服、自動回覆、資料收集

#### 組合 4：排程 → 檢查 → 推播（回訪機制）
```
Cron (定時觸發)
  ↓
Function (檢查條件)
  ↓
IF (條件符合)
  ↓
LINE (推播通知)
```
**適用場景**：付款提醒、訂單狀態、定期通知

---

## 📋 功能串接對照表

### 網站表單處理 → 可串接功能

| 功能 | n8n 節點類型 | 串接位置 | 快速連結 |
|------|--------------|----------|----------|
| 📧 Email 通知 | Email 節點 | Webhook 後 | 步驟 12 |
| 💬 LINE 推播 | LINE 節點 | Webhook 後 | 步驟 36 |
| 💾 資料庫儲存 | Supabase/PostgreSQL 節點 | Webhook 後 | 步驟 25 |
| 💬 Slack 通知 | Slack 節點 | Webhook 後 | 步驟 36 |
| 📋 CRM 同步 | HTTP Request 節點 | Webhook 後 | 步驟 11 |
| 🔄 自動回覆 | Function 節點 | Webhook 後 | 步驟 42 |

### 使用者註冊 → 可串接功能

| 功能 | n8n 節點類型 | 串接位置 | 快速連結 |
|------|--------------|----------|----------|
| ✉️ 歡迎 Email | Email 節點 | Supabase Auth 觸發後 | 步驟 12 |
| 💬 LINE 歡迎訊息 | LINE 節點 | Supabase Auth 觸發後 | 步驟 36 |
| 💾 建立使用者資料 | Supabase 節點 | Auth 觸發後 | 步驟 25 |
| 🎁 發送優惠券 | LINE 節點 | Auth 觸發後 | 步驟 13 |
| 📋 CRM 建立 | HTTP Request 節點 | Auth 觸發後 | 步驟 46 |
| 🔄 7天回訪提醒 | Cron + LINE 節點 | 7天後執行 | 步驟 36 |

### 訂單處理 → 可串接功能

| 功能 | n8n 節點類型 | 串接位置 | 快速連結 |
|------|--------------|----------|----------|
| 📧 訂單確認 Email | Email 節點 | 訂單建立後 | 步驟 12 |
| 💬 LINE 訂單通知 | LINE 節點 | 訂單建立後 | 步驟 36 |
| 📦 庫存更新 | Supabase 節點 | 訂單建立後 | 步驟 25 |
| 💰 付款處理 | Stripe 節點 | 訂單建立後 | 步驟 38 |
| 📦 出貨通知 | LINE 節點 | 付款成功後 | 步驟 36 |
| 🔄 付款提醒（回訪）| Cron + LINE 節點 | 24小時後 | 步驟 36 |

### LINE 訊息處理 → 可串接功能

| 功能 | n8n 節點類型 | 串接位置 | 快速連結 |
|------|--------------|----------|----------|
| 🤖 自動回覆 | Function + LINE 節點 | 訊息接收後 | 步驟 13 |
| 💾 訊息儲存 | Supabase 節點 | 訊息接收後 | 步驟 25 |
| 🔍 AI 分析 | HTTP Request (OpenAI) | 訊息接收後 | 步驟 42 |
| 👤 客服轉接 | Slack/Teams 節點 | AI 無法處理時 | 步驟 36 |
| 📋 表單處理 | Function 節點 | 訊息接收後 | 步驟 13 |
| 🔄 24小時回訪 | Cron + LINE 節點 | 24小時後 | 步驟 36 |

---

## 🎨 視覺化標籤系統

### 標籤分類

#### 功能類型標籤
- 🟢 `通知類` - Email、LINE、Slack 等通知功能
- 🔵 `儲存類` - 資料庫、CRM 等儲存功能
- 🟡 `處理類` - 資料處理、格式轉換
- 🟣 `回訪類` - 定期提醒、自動回訪機制
- 🔴 `整合類` - 第三方服務整合

#### 關聯性標籤
- `form-flow` - 表單處理流程
- `order-flow` - 訂單處理流程
- `line-message-flow` - LINE 訊息流程
- `notification-flow` - 通知發送流程
- `revisit-mechanism` - 回訪機制流程

#### 使用頻率標籤
- ⭐ `常用功能` - 最常使用的功能
- ⭐⭐ `核心功能` - 核心業務功能
- ⭐⭐⭐ `進階功能` - 進階應用

---

## 🚀 快速開始模板

### 模板 1：網站表單自動化（最常用 ⭐）

```
1. Webhook 節點（接收表單）
   ↓
2. Function 節點（資料驗證）
   ↓
3. 並行處理：
   - Email 節點 → 發送通知
   - LINE 節點 → 推播通知
   - Supabase 節點 → 儲存資料
```

**相關步驟**：步驟 12 (Email), 步驟 36 (LINE), 步驟 25 (資料庫)

---

### 模板 2：訂單自動化流程（核心功能 ⭐⭐）

```
1. Webhook 節點（訂單建立）
   ↓
2. Supabase 節點（更新庫存）
   ↓
3. Stripe 節點（付款處理）
   ↓
4. IF 節點（判斷付款狀態）
   ├─ 成功 → Email + LINE 通知
   └─ 失敗 → 付款提醒（回訪機制）
```

**相關步驟**：步驟 38 (Stripe), 步驟 36 (LINE), 步驟 12 (Email)

---

### 模板 3：LINE 回訪機制（回訪類 🟣）

```
1. Cron 節點（每小時檢查）
   ↓
2. Supabase 節點（查詢未付款訂單）
   ↓
3. Function 節點（計算時間差）
   ↓
4. IF 節點（判斷是否超過 24 小時）
   ├─ 是 → LINE 節點（發送提醒）
   └─ 否 → 結束
```

**相關步驟**：步驟 36 (LINE), 步驟 25 (資料庫), 步驟 30 (Cron)

---

## 📝 使用說明

### 如何建立功能串接

1. **確認觸發方式**
   - Webhook（事件觸發）
   - Cron（定時觸發）
   - Supabase 觸發（資料庫事件）

2. **選擇串接功能**
   - 參考上方「功能串接對照表」
   - 查看「快速串接指南」
   - 使用「快速開始模板」

3. **設定 n8n 節點**
   - 依串接位置添加節點
   - 參考相關步驟進行設定
   - 測試功能是否正常

4. **啟用回訪機制**（如需要）
   - 使用 Cron 節點設定排程
   - 使用 Function 節點檢查條件
   - 使用 LINE 節點發送回訪通知

---

## 🎯 下一步

此文件將作為實施 n8n 功能步驟的關聯性參考。

每個步驟將包含：
- ✅ **關聯功能清單** - 可串接的其他功能
- ✅ **n8n 節點位置** - 在流程中的串接位置
- ✅ **快速連結** - 直接跳轉到相關步驟
- ✅ **回訪機制標註** - 如適用，標註 LINE 回訪方式

這樣使用者可以：
- 🎯 清楚看到功能間的關聯
- 🔗 快速建立功能串接
- 🚀 快速開始使用功能
